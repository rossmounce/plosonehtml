<a id="article1.body1.sec1.p6" name="article1.body1.sec1.p6"></a><p>An important point that has not been emphasized in previous work is that different applications may involve different evolutionary processes leading to different kinds of confounding and requiring different solutions. For example, in one process, <em>X</em> and <em>Y</em> coevolve according to the phylogenetic tree—any change in <em>Y</em> during evolution influences the evolution of <em>X</em>, and vice versa. Here, the phylogenetic tree serves as a confounder of <em>X</em> and <em>Y</em> in the traditional sense—the tree is a hidden common cause of both <em>X</em> and <em>Y</em>, leading to spurious correlations between <em>X</em> and <em>Y</em> when the tree is ignored. In another process, only <em>Y</em> evolves according to the tree and the influence of <em>X</em> on <em>Y</em> occurs only at the tips of the tree. <em>X</em> need not evolve according to the tree or “follow the tree,” but instead can have any distribution, including one in which the observations of <em>X</em> are IID. We refer to these two processes as <em>coevolution</em> and <em>conditional influence</em>, respectively.</p>
<a id="article1.body1.sec1.p7" name="article1.body1.sec1.p7"></a><p>Both processes lead to confounding, as evidenced by the example in <a href="#pone-0000591-g001">Figure 1</a>, which is agnostic about whether <em>X</em> follows the tree. Each process, however, leads to a particular form of confounding that, as we will show, requires a specific solution. In this paper, we use a particular statistical model class known as a <em>generative</em> model both to describe these processes and to address each form of confounding that they entail. We describe the <em>undirected joint model</em> of Pollock, Taylor and Goldman <a href="#pone.0000591-Pollock1">[5]</a>, which represents the traditional confounding process where both <em>X</em> and <em>Y</em> follow the tree, and our own <em>conditional model</em> introduced in Bhattacharya <em>et al.</em> <a href="#pone.0000591-Bhattacharya1">[12]</a>, which represents the confounding process where only <em>Y</em> follows the tree. We show how these models can be used to identify correlations among data when either form of confounding is present. The basic idea behind the approach is to determine the degree to which a generative model that includes a correlation between <em>X</em> and <em>Y</em> explains the data better than a model that uses only the phylogeny to explain the data.</p>
<a id="article1.body1.sec1.p8" name="article1.body1.sec1.p8"></a><p>Using synthetic data, we show that the coevolution model better addresses the confounding of the coevolution process, and the conditional model better addresses the confounding of the conditional process. In addition, we apply these two models to real examples, including the identification of escape mutations in HIV-1 in response to specific HLA-mediated immune pressure and the prediction of coevolving residues in an HIV-1 peptide, and find that no one model is best for all applications.</p>
<a id="article1.body1.sec1.p9" name="article1.body1.sec1.p9"></a><p>So far, we have considered only phylogeny as a source of hierarchical population structure. Nonetheless, we also will explore the use of these generative models, which incorporate evolutionary processes, to address hierarchical population structure in its more general case. In particular, we apply these models to a genomic search for genotypes that are associated with bacterial resistance traits in <em>Arabidopsis</em> and show that they are effective.</p>
<a id="article1.body1.sec1.p10" name="article1.body1.sec1.p10"></a><p>We have implemented methods for fitting these models in a package called PhyloD, which is available on the internet as both a web based application and downloadable source at <a href="http://atom.research.microsoft.com/bio/phylod.aspx">http://atom.research.microsoft.com/bio/p​hylod.aspx</a>.</p>
</div>

<div id="section2" class="section"><a id="s2" name="s2" toc="s2" title="Results"></a><h3>Results</h3>
<h4>Overview of models</h4>
<a id="article1.body1.sec2.sec1.p1" name="article1.body1.sec2.sec1.p1"></a><p>The models that we describe are generative models, also known as directed acyclic graphical models <a href="#pone.0000591-Heckerman1">[34]</a>. A generative model consists of (1) a <em>structure</em>, a directed acyclic graph where nodes correspond to variables and missing arcs specify probabilistic independencies among the variables, and (2) a set of conditional probability distributions, one distribution for each node. The probabilistic independences specified by the structure of the graph allow the joint distribution of the data to be written as the product over the nodes of their conditional distributions. Given the structure of a generative model, we can use observations for some (and not necessarily all) nodes to infer the distributions (or parameters of the distributions) of the model <a href="#pone.0000591-Heckerman1">[34]</a>. One common criterion for inference, which we use here, is to identify the distributions that maximize the likelihood of the data.</p>
<a id="article1.body1.sec2.sec1.p2" name="article1.body1.sec2.sec1.p2"></a><p>To represent the hierarchical population structure, our generative models use the same machinery as that found in the maximum-likelihood phylogenetic tree <a href="#pone.0000591-Felsenstein2">[35]</a>. As we have discussed, however, such hierarchical structure may not arise due to phylogenetic relationships. Also, we note that the trees are built from sequence data alone (see <a href="#s4">Methods</a> and Discussion).</p>
<h5>Single-variable model.</h5><a id="article1.body1.sec2.sec1.sec1.p1" name="article1.body1.sec2.sec1.sec1.p1"></a><p>Before we consider models of associations between variables, let us consider the situation where a <em>single</em> variable <em>Y</em> with possible states present (<em>y</em>) and absent (<em>y̅</em>) is generated by a given phylogenetic tree. The structure of the generative model, which is simply the series of branches in the phylogenetic tree, is shown in <a href="#pone-0000591-g002">Figure 2a</a>. Nodes at the tips of tree, labeled <em>Y</em><sub>1</sub>, … , <em>Y<sub>N</sub></em> correspond to the observations of <em>Y</em>. Unlabeled nodes in the interior of the tree correspond to events of divergence. (Although each <em>Y<sub>i</sub></em> and interior node corresponds to a variable in the ordinary statistical sense, we sometimes refer to the collection of variables—<em>Y</em> in this case—as a variable. The proper meaning of the word should be clear from context.) As in the probabilistic model of Felsenstein <a href="#pone.0000591-Felsenstein2">[35]</a> for a phylogenetic tree, we assume that the transition from state <em>i</em> to state <em>j</em> along a transition with branch length <em>t</em> will occur with probability <strong>P</strong><em><sub>ij</sub></em>(<em>t</em>) that is determined by a continuous time Markov process (CTMP). In our single binary variable case, the CTMP is parameterized by a single rate parameter λ, and the stationary probability π, the probability of <em>Y = y</em> reached by the Markov process after an infinite amount of time. The instantaneous rate of change from <em>y̅</em> to <em>y</em> is λ π, yielding a transition probability matrix whose values as a function of time <em>t</em> are given by<a name="" id=""></a><span class="equation"><img src="/article/fetchObject.action?uri=info:doi/10.1371/journal.pone.0000591.e001&amp;representation=PNG" class="inline-graphic"><span class="note">(1)</span></span><br>Where π<em><sub>j</sub></em> = π when <em>j</em> corresponds to the presence of <em>Y</em>, and π<em><sub>j</sub></em> = 1−π when <em>j</em> corresponds to the absence of <em>Y</em>.</p>
<div class="figure" id="pone-0000591-g002"><div class="img"><a name="pone-0000591-g002" title="Click for larger image " href="/article/fetchObject.action?uri=info:doi/10.1371/journal.pone.0000591.g002&amp;representation=PNG_M" data-doi="info:doi/10.1371/journal.pone.0000591" data-uri="info:doi/10.1371/journal.pone.0000591.g002"><img src="/article/fetchObject.action?uri=info:doi/10.1371/journal.pone.0000591.g002&amp;representation=PNG_I" alt="thumbnail" class="thumbnail"></a></div><div class="figure-inline-download">
            Download:
            <ul><li><div class="icon"><a href="/article/info:doi/10.1371/journal.pone.0000591.g002/powerpoint">
                    PPT
                  </a></div><a href="/article/info:doi/10.1371/journal.pone.0000591.g002/powerpoint">
                  PowerPoint slide
                </a></li><li><div class="icon"><a href="/article/info:doi/10.1371/journal.pone.0000591.g002/largerimage">
                    PNG
                  </a></div><a href="/article/info:doi/10.1371/journal.pone.0000591.g002/largerimage">
                  larger image
                  (<span id="info:doi/10.1371/journal.pone.0000591.g002.PNG_L"></span>)
                </a></li><li><div class="icon"><a href="/article/info:doi/10.1371/journal.pone.0000591.g002/originalimage">
                    TIFF
                  </a></div><a href="/article/info:doi/10.1371/journal.pone.0000591.g002/originalimage">
                  original image
                  (<span id="info:doi/10.1371/journal.pone.0000591.g002.TIF"></span>)
